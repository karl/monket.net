<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Autotest Growl notifications on Windows (using Snarl) - Karl O'Keeffe
    </title>
    <link rel="alternate" href="//feed.xml" type="application/rss+xml" title="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="article-detail">
    <header class="header">
      <div class="content-wrap">
        <h1>Autotest Growl notifications on Windows (using Snarl)</h1>
        <p class="author">Written by <span class="author"><a href="mailto:blog@monket.net">Karl O'Keeffe</a></span>
        </p>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><p><a href="/articles/simple-example-of-autotest-cucumber-and-growl/">Growl and Autotest work brilliantly together</a>. Autotest runs all your tests in the background every time a file changes, giving you extremely fast feedback on your test driven development. And Growl notifications save you from needing to flip back to the Terminal to see the result of each test run, you get an unobtrusive popup in the corner of your screen showing the success or failure of the&nbsp;tests.</p>
<p>But what about those users working on the Windows&nbsp;platform?</p>
<p><a href="http://www.fullphat.net/index.php">Snarl</a> is a windows counterpart to Growl. Providing much of the same&nbsp;functionality.</p>
<p>And there is a Snarl Ruby gem allowing us to create Snarl notifications from&nbsp;Ruby.</p>
<p>So lets convert our Growl calls to Snarl calls, and get Autotest notifications under&nbsp;Windows.</p>
<h2 id="installing-autotest-snarl-and-the-growl-to-snarl-converter">Installing Autotest, Snarl, and the Growl to Snarl&nbsp;converter</h2>
<p>If you haven’t already <a href="http://www.ruby-lang.org/en/downloads/">download and install Ruby</a>.</p>
<p>First up we need to <a href="http://www.fullphat.net/index.php">download and install Snarl</a>.</p>
<p>Then we need to install Autotest and the autotest-growl gem (that we are later going to override). Open a command prompt, and type the following (Autotest is part of the ZenTest&nbsp;gem):</p>
<pre><code class="lang-bash">gem install ZenTest
gem install ruby-snarl
gem install autotest-growl
</code></pre>
<p>Then save the code below to <code>lib/autotest/growl-to-snarl.rb</code> within your project. This code converts any Growl calls to equivalent Snarl&nbsp;calls.</p>
<h4 id="growl-to-snarl-rb">growl-to-snarl.rb</h4>
<pre><code class="lang-ruby"><span class="keyword">require</span> <span class="string">'snarl'</span>
<span class="class"><span class="keyword">module</span> <span class="title">Autotest::Growl</span></span>

  <span class="comment"># Display a message through Snarl.</span>
  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">growl</span> <span class="title">title</span>, <span class="title">message</span>, <span class="title">icon</span>, <span class="title">priority=</span>0, <span class="title">stick=</span>""</span>
    image = <span class="constant">File</span>.join(<span class="constant"><span class="caps">ENV</span></span>[<span class="string">'<span class="caps">HOME</span>'</span>], <span class="string">'.autotest-growl'</span>, <span class="string">"<span class="subst">#{icon}</span>.png"</span>)
    image = <span class="constant">File</span>.join(<span class="constant">GEM_PATH</span>, <span class="string">'img'</span>, <span class="string">"<span class="subst">#{icon}</span>.png"</span>) <span class="keyword">unless</span> <span class="constant">File</span>.exists?(image)

    <span class="constant">Snarl</span>.show_message(title, message.inspect, image)
  <span class="keyword">end</span>

<span class="keyword">end</span>
</code></pre>
<p>Next we need to update our <code>.autotest</code> configuration file to include the autotest-growl gem, and the Growl to Snarl converter. Add the following to your <code>.autotest</code> file in the project root&nbsp;directory.</p>
<pre><code class="lang-ruby"><span class="keyword">require</span> <span class="string">'autotest-growl'</span>
<span class="keyword">require</span> <span class="string">'snarl'</span>
<span class="keyword">require</span> <span class="string">'lib/autotest/growl-to-snarl'</span>
</code></pre>
<h2 id="running-autotest-with-snarl-support">Running Autotest with Snarl&nbsp;support</h2>
<p>First up ensure Snarl is running (check for the icon in the system&nbsp;tray).</p>
<p>Autotest will fail to run on Windows if a <code>HOME</code> environment variable doesn’t exist, so we need to create one before we run (I’ve also noticed that the Ruby <code>gem</code> command will fail to run if the <code>HOME</code> evironment variable <em>does</em> exist, which is&nbsp;frustrating!).</p>
<p>Open a command prompt, navigate to the project root directory. Then enter the following to set the <code>HOME</code> environment variable and run&nbsp;Autotest.</p>
<pre><code class="lang-bash"><span class="built_in">set</span> <span class="caps">HOME</span>=<span class="string">"C:\Documents and Settings\username"</span>
autotest
</code></pre>
<p>The results of your test runs should now display as Snarl&nbsp;notifications.</p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/">« Full blog</a></div>
        <section class="about"><p>Personal homepage of Karl O’Keeffe.</p>

        </section>
        <section class="copy">
          <p>© 2015 Karl O'Keeffe</p>
        </section>
      </div>
    </footer>
  </body>
</html>