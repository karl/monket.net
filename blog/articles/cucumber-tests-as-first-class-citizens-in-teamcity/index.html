<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Cucumber Tests as First Class Citizens in TeamCity - Karl O'Keeffe
    </title>
    <link rel="alternate" href="//feed.xml" type="application/rss+xml" title="">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="article-detail">
    <header class="header">
      <div class="content-wrap">
        <div class="logo">
          <h1><a href="/">Karl O'Keeffe</a></h1>
        </div>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><p><a href="http://www.jetbrains.com/teamcity/">TeamCity</a> is a great continuous integration server, and has brilliant built in support for running <a href="http://www.nunit.org/">NUnit</a> tests. The web interface updates automatically as each test is run, and gives immediate feedback on which tests have failed without waiting for the entire suite to finish. It also keeps track of tests over multiple builds, showing you exactly when each test first failed, how often they fail&nbsp;etc.</p>
<p>If like me you are using <a href="http://cukes.info/">Cucumber</a> to run your acceptance tests, wouldn’t it be great to get the same level of TeamCity integration for every Cucumber test. Well now you can, using the <code>TeamCity::Cucumber::Formatter</code> from the TeamCity 5.0 <span class="caps">EAP</span>&nbsp;release.</p>
<p>JetBrains, the makers of TeamCity, released a <a href="http://blogs.jetbrains.com/ruby/2009/08/testing-rubymine-with-cucumber/">blog post demostrating the Cucumber test integration</a>, but without any details in how to set it up yourself. So I’ll take you through it&nbsp;here.</p>
<h2 id="getting-a-copy-of-the-teamcity-cucumber-formatter">Getting a Copy of the TeamCity Cucumber&nbsp;Formatter</h2>
<p>The <a href="http://www.jetbrains.net/confluence/display/TW/TeamCity+EAP">latest TeamCity <span class="caps">EAP</span></a> contains the new Cucumber Formatter hidden deep in it’s bowels. Rather than make you wade through it all, I’ve extracted the relevant files and they are available to download&nbsp;here:</p>
<h4 id="-download-the-teamcity-cucumber-formatter-teamcitycucumberformatter-zip-"><a href="/blog/articles/cucumber-tests-as-first-class-citizens-in-teamcity/TeamCityCucumberFormatter.zip">Download the TeamCity Cucumber&nbsp;Formatter</a></h4>
<p>The archive contains the formatter and the TeamCity library files it requires to run. Extract the archive in your project root and it will add the following&nbsp;files:</p>
<pre><code class="lang-plain">features/
    support/
        jetbrains-teamcity-formatter.rb
lib/
    teamcity/
        [some support and utility files]
</code></pre>
<p>If you want to locate these files within the TeamCity <span class="caps">EAP</span> yourself, <a href="http://download.jetbrains.com/teamcity/TeamCity-10307.war">download the TeamCity 5.0 <span class="caps">EAP</span> War</a> file and extract it. Then from within the war unzip <code>WEB-INF/plugins/rake-runner-plugin.zip</code>. And from within the rake-runner-plugin look at <code>rake-runner/lib/rb/patch/bdd/teamcity/cucumber/formatter.rb</code> and all the files in <code>rake-runner/lib/rb/patch/common/teamcity/</code>.</p>
<p>The formatter in my download has been tweaked to look in a new location for the teamcity support files, and has been changed to be a single class in a module named <code>JBTeamCityFormatter</code> (to ease calling it from the command&nbsp;line).</p>
<p>The relevant changes in the file&nbsp;are:</p>
<pre><code class="lang-ruby">
<span class="variable">$:</span> &lt;&lt; <span class="constant">File</span>.expand_path(<span class="constant">File</span>.dirname(__FILE_<span class="number">_</span>) + <span class="string">'/../../lib/'</span>)
<span class="keyword">require</span> <span class="string">'teamcity/runner_common'</span>
<span class="keyword">require</span> <span class="string">'teamcity/utils/service_message_factory'</span>
<span class="keyword">require</span> <span class="string">'teamcity/utils/runner_utils'</span>
<span class="keyword">require</span> <span class="string">'teamcity/utils/url_formatter'</span>

<span class="class"><span class="keyword">class</span> <span class="title">JBTeamCityFormatter</span> <span class="inheritance">&lt; </span>::<span class="title">Cucumber::Ast::Visitor</span></span>
</code></pre>
<h2 id="setting-up-cucumber-to-use-the-teamcity-formatter">Setting up Cucumber to use the TeamCity&nbsp;Formatter</h2>
<p>Once you have the formatter installed you can use it as with any Cucumber formatter by adding it as a command line&nbsp;parameter:</p>
<pre><code class="lang-bash">cucumber features <span class="operator">-f</span> JBTeamCityFormatter
</code></pre>
<p>To use it with TeamCity, add a profile your <code>cucumber.yml</code> file that runs all your features using the new&nbsp;formatter:</p>
<h4 id="cucumber-yml">cucumber.yml</h4>
<pre><code class="lang-yaml">default: features -q
teamcity: features -q --no-c  -f JBTeamCityFormatter
</code></pre>
<h2 id="running-cucumber-with-teamcity">Running Cucumber with&nbsp;TeamCity</h2>
<p>Now when you run Cucumber within TeamCity (using the <code>teamcity</code> profile) it will report tests in real time, with all the feedback you are used to. Just add a call to the Cucumber executable to your build script (NAnt, MSBuild, Ant, Rake,&nbsp;etc).</p>
<p><img src="/blog/articles/cucumber-tests-as-first-class-citizens-in-teamcity/cucumber-tests-in-teamcity-cropped.png" alt="Cucumber tests in TeamCity"></p>
<p>Enjoy the new found treatment of Cucumber tests as first class citizens in&nbsp;TeamCity!</p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/blog/">« Full blog</a></div>
        <section class="about"><p>Personal homepage of Karl O’Keeffe.</p>

        </section>
      </div>
    </footer>
  </body>
</html>