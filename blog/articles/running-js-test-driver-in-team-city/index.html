<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Running JS Test Driver in Team City - Karl O'Keeffe
    </title>
    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <style>body {
  box-sizing: border-box;
  color: #333;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 16px;
  letter-spacing: 0.2px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  word-wrap: break-word;
}

a {
  color: #2469C8;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

h1, h2, h3, h4, h5, h6, p, body, a, img, ul, ol, blockquote, pre {
  margin: 0; padding: 0; border: 0;
}

body {
  background-color: #ffffff;
  /*text-rendering: optimizeLegibility;*/
}

.content-wrap {
  width: 34em;
  margin: 0 auto;
}

p {
  margin-top: 0;
  margin-bottom: 16px;
}

h1 {
  font-size: 2em;
  margin-bottom: 1em;
}

h2 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  padding-bottom: .3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

h3 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  font-size: 1.5em;
  line-height: 1.43;
}

ol, ul {
  padding: 0;
  padding-left: 2em;
  margin-top: 0;
  margin-bottom: 16px;
}

blockquote {
  margin: 1.2em 3em;
  padding-left: 1em;
  font-style: italic;
}

hr {
  border: 0;
  border-top: 1px dashed #d2d2d2;
  height: 0;
  margin: 1.6em 0;
}

/* page header */

.header {
  padding: 2em;
  background: #FFA91A;
}

.header h1 {
  font-size: 2.6em;
  text-align: center;
  font-weight: 700;
  margin: 0;
}

.header a, .header a:hover {
  text-decoration: none;
  color: #ffffff;
}

/* page footer */

footer {
  margin: 3em 0;
}

footer .nav {
  text-align: center;
  margin-top: 5em;
  margin-bottom: 3.5em;
}

footer .nav a {
  padding: 0 0.5em;
  font-size: 1.2em;
  text-decoration: none;
}

footer .about {
  padding: 2.2em 3em;
  text-align: center;
  color: #888;
}

/* article */

.article {
  margin: 3em 0 4em;
}

.article header .date {
  text-align: center;
  margin-top: -0.7em;
}

.article .content img {
  display: block;
  width: 100%;
}

/* code styling */

p code,
h2 code {
  font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
  padding: 0;
  padding-top: .2em;
  padding-bottom: .2em;
  margin: 0;
  font-size: 85%;
  background-color: #f7f7f7;
  border-radius: 3px;
}

h2 code:before,
h2 code:after,
p code:before,
p code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

pre {
  font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
  word-wrap: normal;
  padding: 16px;
  overflow: auto;
  /*font-size: 100%;*/
  font-size: 13.6px;
  line-height: 1.45;
  background-color: #f7f7f7;
  border: 0;
  border-radius: 3px;
  margin-top: 0;
  margin-bottom: 16px;
}

pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
  /*font-size: 100%;*/
  white-space: pre;
  background: transparent;
  border-radius: 3px;
}

/* syntax hl stuff */

code.lang-markdown {
  color: #424242;
}

code.lang-markdown .header,
code.lang-markdown .strong {
  font-weight: bold;
}

code.lang-markdown .emphasis {
  font-style: italic;
}

code.lang-markdown .horizontal_rule,
code.lang-markdown .link_label,
code.lang-markdown .code,
code.lang-markdown .header,
code.lang-markdown .link_url {
  color: #555;
}

code.lang-markdown .blockquote,
code.lang-markdown .bullet {
  color: #bbb;
}

/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
.tomorrow-comment, pre .comment, pre .title {
  color: #8e908c;
}

.tomorrow-red, pre .variable, pre .attribute, pre .tag, pre .regexp, pre .ruby .constant, pre .xml .tag .title, pre .xml .pi, pre .xml .doctype, pre .html .doctype, pre .css .id, pre .css .class, pre .css .pseudo {
  color: #c82829;
}

.tomorrow-orange, pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
  color: #f5871f;
}

.tomorrow-yellow, pre .class, pre .ruby .class .title, pre .css .rules .attribute {
  color: #eab700;
}

.tomorrow-green, pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
  color: #718c00;
}

.tomorrow-aqua, pre .css .hexcolor {
  color: #3e999f;
}

.tomorrow-blue, pre .function, pre .python .decorator, pre .python .title, pre .ruby .function .title, pre .ruby .title .keyword, pre .perl .sub, pre .javascript .title, pre .coffeescript .title {
  color: #4271ae;
}

.tomorrow-purple, pre .keyword, pre .javascript .function {
  color: #8959a8;
}

/* media queries */

@media (max-width: 690px) {
  .content-wrap {
    width: auto;
    padding: 0 1em;
  }
  .header {
    padding: 1em;
  }
  .header h1 {
    font-size: 1.4em;
  }
  .article {
    margin: 1em 0 2.5em;
  }
  .archive {
    width: 80%;
    margin: 0 auto;
  }
  .archive * {
    float: none !important;
    line-height: 1.6 !important;
    width: auto !important;
    height: auto !important;
    text-align: left !important;
    border: 0 !important;
    margin: 0 !important;
  }
  footer .nav {
    margin: 1em 0;
  }
  footer .about {
    padding: 0;
    padding-top: 1.6em;
  }
  footer .about p {
    margin-bottom: 1em;
  }
}

    </style>
  </head>
  <body>
    <header class="header">
      <div class="content-wrap">
        <div class="logo">
          <h1><a href="/">Karl O'Keeffe</a></h1>
        </div>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <header>
            <h2><a href="/blog/articles/running-js-test-driver-in-team-city/">Running JS Test Driver in Team City</a></h2>
            <p class="date"><span>25. August 2009</span></p>
          </header>
          <section class="content"><p><a href="http://code.google.com/p/js-test-driver/"><span class="caps">JS</span> Test Driver</a> is a great new Javascript Testing Framework from the guys at Google. It provides a blisteringly fast, and easily automated way of running your Javascript unit tests. See this <a href="http://misko.hevery.com/2009/05/22/yet-another-javascript-testing-framework/">introduction to <span class="caps">JS</span> Test Driver by Miško Hevery</a> for a great&nbsp;overview.</p>
<p>Getting <span class="caps">JS</span> Test Driver up and running on your development workstation is easy enough. But how about on a continuous integration server such as <a href="http://www.jetbrains.com/teamcity/">TeamCity</a>?</p>
<p>It’s easy, just follow the instructions&nbsp;below!</p>
<h2 id="install-java-and-the-js-test-driver-jar-on-all-the-build-agents">Install Java and the <span class="caps">JS</span> Test Driver jar on all the build&nbsp;agents</h2>
<p><span class="caps">JS</span> Test Driver is packaged as a Java jar, and therefore all the TeamCity build agents will need a copy of Java and the JS Test Driver jar in order to run the&nbsp;tests.</p>
<ul>
<li>For each Build&nbsp;Agent</li>
<li><a href="http://www.java.com/en/download/manual.jsp">Download Java</a> and install&nbsp;it.</li>
<li><a href="http://code.google.com/p/js-test-driver/downloads/list">Download the <span class="caps">JS</span> Test Driver jar</a> and save it to <code>c:\TeamCityBuildTools\JSTestDriver\</code> (or whichever location you&nbsp;wish)</li>
</ul>
<h2 id="configure-js-test-driver">Configure <span class="caps">JS</span> Test&nbsp;Driver</h2>
<p>This guide assumes you already have <span class="caps">JS</span> Test Driver and some tests set up on your local machine. If not see this <a href="http://misko.hevery.com/2009/05/22/yet-another-javascript-testing-framework/">introduction to <span class="caps">JS</span> Test Driver by Miško Hevery</a>.</p>
<p>Just make sure that the <span class="caps">JS</span> Test Driver config file is set to connect to the local machine, on port 9876 (on another port of your choice).&nbsp;E.g.</p>
<pre><code class="lang-yaml">server: http://localhost:9876

load:
  # list of files to load here...
</code></pre>
<h2 id="configure-your-build-process-to-call-js-test-driver">Configure your build process to call <span class="caps">JS</span> Test&nbsp;Driver</h2>
<p>Now that we have <span class="caps">JS</span> Test Driver installed on our build machines, and configured correctly, let’s call it from our build process. At 7digital we are using MSBuild, so we can create a JSTestDriver Target as&nbsp;so:</p>
<pre><code class="lang-xml"><span class="tag">&lt;<span class="title">Target</span> <span class="attribute">Name</span>=<span class="value">"JSTestDriver"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">Message</span> <span class="attribute">Text</span>=<span class="value">"##teamcity[progressMessage 'Running <span class="caps">JS</span> Test Driver']"</span> <span class="attribute">Importance</span>=<span class="value">"high"</span> /&gt;</span>
  <span class="tag">&lt;<span class="title">Message</span> <span class="attribute">Text</span>=<span class="value">"-------- Running <span class="caps">JS</span> Test Driver --------"</span> <span class="attribute">Importance</span>=<span class="value">"high"</span> /&gt;</span>

  <span class="tag">&lt;<span class="title">PropertyGroup</span>&gt;</span>
    <span class="tag">&lt;<span class="title">JSTestDriverJar</span>&gt;</span>"$(BuildToolsPath)\JSTestDriver\jsTestDriver.jar"<span class="tag">&lt;/<span class="title">JSTestDriverJar</span>&gt;</span>
    <span class="tag">&lt;<span class="title">ConfigFile</span>&gt;</span>"$(SolutionFolder)\jsTestDriver.conf"<span class="tag">&lt;/<span class="title">ConfigFile</span>&gt;</span>
    <span class="tag">&lt;<span class="title">IEPath</span>&gt;</span>"C:\Program Files\Internet Explorer\iexplore.exe"<span class="tag">&lt;/<span class="title">IEPath</span>&gt;</span>
    <span class="tag">&lt;<span class="title">OutputDir</span>&gt;</span>"$(SolutionFolder)\output\JSTestDriver"<span class="tag">&lt;/<span class="title">OutputDir</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">PropertyGroup</span>&gt;</span>

  <span class="tag">&lt;<span class="title">Exec</span> <span class="attribute">Command</span>=<span class="value">"java -jar $(JSTestDriverJar) --port 9876 --browser $(IEPath) --config $(ConfigFile) --tests all --testOutput $(OutputDir)"</span> /&gt;</span>

<span class="tag">&lt;/<span class="title">Target</span>&gt;</span>
</code></pre>
<p>The important points here are that you have the properties configured correctly (JSTestDriverJar, ConfigFile, etc) for your individual&nbsp;setup.</p>
<p>The Exec command will automatically create a <span class="caps">JS</span> Test Driver server, launch IE, and run all the tests. The test results will be output to the OutputDir in a JUnit compatible xml format. See the <a href="http://code.google.com/p/js-test-driver/wiki/ContinuousBuild"><span class="caps">JS</span> Test Driver continuous integration page</a> for more&nbsp;information.</p>
<p>Once you have created this Target, ensure it is called by your standard bulid Target by adding it as a&nbsp;dependancy:</p>
<pre><code class="lang-xml"><span class="tag">&lt;<span class="title">Target</span> <span class="attribute">Name</span>=<span class="value">"BuildAndUnitTest"</span> <span class="attribute">DependsOnTargets</span>=<span class="value">"Compile;JSLint;JSTestDriver;NUnit"</span> /&gt;</span>
</code></pre>
<h2 id="have-teamcity-pick-up-the-test-results">Have TeamCity pick up the test&nbsp;results</h2>
<p>If you run your build through TeamCity now, you will see that it runs all your Javascript tests using <span class="caps">JS</span> Test Driver. But it doesn’t report any results. And test failures don’t stop the&nbsp;build.</p>
<p>Luckily TeamCity can import the <span class="caps">JS</span> Test Driver output xml, because it is JUnit&nbsp;compatible.</p>
<ul>
<li>Select the build which is running the <span class="caps">JS</span> Test Driver&nbsp;tests</li>
<li>Click <code>Edit Configuration Settings</code></li>
<li>Click on build step 3 (e.g. <code>Runner: MSBuild</code>)</li>
<li>Under the <code>XML Report Processing</code> section, choose <code>Ant JUnit</code> from the <code>Import data</code> from&nbsp;dropdown</li>
<li>In the <code>Report paths</code> text area add the relative path the the <span class="caps">JS</span> Test Driver output file (e.g. <code>output\JSTestDriver\TEST-com.google.jstestdriver.1.xml</code>)</li>
<li>Click <code>save</code>!</li>
</ul>
<p>Now when you run your build again you will see your <span class="caps">JS</span> Test Driver tests showing up in the Tests tab, and test failures now stop the&nbsp;build.</p>
<p>Your Javascript unit tests now sit as first class citizens within&nbsp;TeamCity!</p>
<p><a href="/blog/articles/running-js-test-driver-in-team-city/JSTestDriverFailedTest.png"><img src="/blog/articles/running-js-test-driver-in-team-city/JSTestDriverFailedTest.png" alt="JSTestDriverFailedTest" title="JSTestDriverFailedTest"></a></p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/blog/">Full blog</a></div>
        <section class="about"><p>Personal homepage of <a href="/">Karl O’Keeffe</a>.</p>

        </section>
      </div>
    </footer>
  </body>
</html>