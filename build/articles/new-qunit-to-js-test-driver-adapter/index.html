<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>New QUnit to JS Test Driver adapter - Karl O'Keeffe
    </title>
    <link rel="alternate" href="//feed.xml" type="application/rss+xml" title="">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="article-detail">
    <header class="header">
      <div class="content-wrap">
        <h1>New QUnit to JS Test Driver adapter</h1>
        <p class="author">Written by <span class="author"><a href="mailto:blog@monket.net">Karl O'Keeffe</a></span>
        </p>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><div class="info">The code in this post is out of date. The latest code can always be found in the <a href="http://code.google.com/p/js-test-driver/wiki/QUnitAdapter"><span class="caps">JS</span> Test Driver google code site</a></div>

<p>In my <a href="/articles/qunit-and-js-test-driver/">previous post on QUnit and <span class="caps">JS</span> Test Driver</a> I showed how to run your <a href="http://docs.jquery.com/QUnit">qunit</a> tests with <a href="http://code.google.com/p/js-test-driver/"><span class="caps">JS</span> Test Driver</a>.</p>
<p>The technique used was to run the tests with qunit, and report either their success or failure to <span class="caps">JS</span> Test Driver. This works, but you miss out on the important feedback of exactly which assertions have failed, and&nbsp;why.</p>
<p>This problem has led me to taking a new approach to running qunit tests with <span class="caps">JS</span> Test Driver, where I don’t use any of the existing qunit code, and instead just create an interface wrapper that converts qunit style tests and assertions directly into JS Test Driver tests and&nbsp;assertions.</p>
<p>This gives assertion level error reporting, making it much easier to write and debug tests. Essentially this adapter allows you to write native <span class="caps">JS</span> Test Driver tests, but using the less verbose qunit&nbsp;syntax.</p>
<p>The new approach also means that qunit lifecycles (setup and teardown)&nbsp;work.</p>
<h2 id="installing-the-qunit-adapter">Installing the QUnit&nbsp;Adapter</h2>
<p>First up download the <a href="http://monket.net/blog/wp-content/uploads/2009/06/equiv.js">equiv.js</a> file, which is required for the qunit <code>same</code> assertion.</p>
<p>Then download the <a href="http://monket.net/blog/wp-content/uploads/2009/06/QUnitAdapter.js">QUnitAdapter.js</a> file (or copy the code&nbsp;below).</p>
<h4 id="-qunitadapter-js-http-monket-net-blog-wp-content-uploads-2009-06-qunitadapter-js-"><a href="http://monket.net/blog/wp-content/uploads/2009/06/QUnitAdapter.js">QUnitAdapter.js</a></h4>
<pre><code class="lang-javascript">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{

    <span class="built_in">window</span>.module = <span class="function"><span class="keyword">function</span>(<span class="params">name, lifecycle</span>) </span>{
        QUnitTestCase = TestCase(name);

        <span class="keyword">if</span> (lifecycle) {
            QUnitTestCase.prototype.setUp = lifecycle.setup;
            QUnitTestCase.prototype.tearDown = lifecycle.teardown;
        }
    };

    <span class="built_in">window</span>.test = <span class="function"><span class="keyword">function</span>(<span class="params">name, test</span>) </span>{
        QUnitTestCase.prototype[<span class="string">'test '</span> + name] = test;
    };

    <span class="built_in">window</span>.expect = <span class="function"><span class="keyword">function</span>(<span class="params">count</span>) </span>{
        expectAsserts(count);
    };

    <span class="built_in">window</span>.ok = <span class="function"><span class="keyword">function</span>(<span class="params">actual, msg</span>) </span>{
        assertTrue(msg ? msg : <span class="string">''</span>, actual);
    };

    <span class="built_in">window</span>.equals = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, msg</span>) </span>{
        assertEquals(msg ? msg : <span class="string">''</span>, b, a);
    };

    <span class="built_in">window</span>.start = <span class="built_in">window</span>.stop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
        fail(<span class="string">'start and stop methods are not available when using <span class="caps">JS</span> Test Driver.\n'</span> +
            <span class="string">'Use jsUnit Clock object to deal with timeouts and intervals:\n'</span> +
            <span class="string">'http://googletesting.blogspot.com/2007/03/javascript-simulating-time-in-jsunit.html.'</span>);
    };

    <span class="built_in">window</span>.same = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, msg</span>) </span>{
        assertTrue(msg ? msg : <span class="string">''</span>, <span class="built_in">window</span>.equiv(b, a));
    };

    <span class="built_in">window</span>.reset = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
        fail(<span class="string">'reset method is not available when using <span class="caps">JS</span> Test Driver'</span>);
    };

    <span class="built_in">window</span>.isLocal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
        <span class="keyword">return</span> <span class="literal">false</span>;
    };

    <span class="built_in">window</span>.QUnit = {
        equiv: <span class="built_in">window</span>.equiv,
        ok: <span class="built_in">window</span>.ok
    };

})();
</code></pre>
<p>Save both these files to your project (for example <code>tests/qunit/</code>).</p>
<h2 id="configuring-js-test-driver">Configuring <span class="caps">JS</span> Test&nbsp;Driver</h2>
<p>To run your qunit tests in <span class="caps">JS</span> Test Driver you need to configure it to load the adapter before your qunit&nbsp;tests.</p>
<p>Update your <code>jsTestDriver.conf</code> to load the&nbsp;files:</p>
<pre><code class="lang-yaml">server: http://localhost:9876

load:
  # Add these lines to load the equiv function and adapter in order, before the tests
  # (assuming they are saved to tests/qunit/)
  - tests/qunit/equiv.js
  - tests/qunit/QUnitAdapter.js

  # This is where we load the qunit tests
  - tests/js/*.js

  # And this loads the source files we are testing
  - src/js/*.js
</code></pre>
<h2 id="running-js-test-driver-with-qunit-tests">Running <span class="caps">JS</span> Test Driver with qunit&nbsp;tests</h2>
<p>Now we can run <span class="caps">JS</span> Test Driver and watch as it runs all our qunit&nbsp;tests!</p>
<p>The tests will run as individual <span class="caps">JS</span> Test Driver tests, with the format <code>_Module Name_._Test Name_</code>.</p>
<p>Example&nbsp;output:</p>
<pre><code class="lang-plain">[PASSED] Module 1.test Test 1
[PASSED] Module 1.test Test 2
[PASSED] Module 2.test Test 1
Total 3 tests (Passed: 3; Fails: 0; Errors: 0) (1.00 ms)
  Safari 530.18: Run 3 tests (Passed: 3; Fails: 0; Errors 0) (1.00 ms)
</code></pre>
<h2 id="limitations">Limitations</h2>
<p>There are a few limitations on which qunit tests will successfully be&nbsp;converted.</p>
<p>The tests must run synchronously (which means no use of the qunit <code>stop</code> and <code>start</code> methods).</p>
<p>If you need to test timeouts, intervals, or other asynchronous sections of  code, consider <a href="http://googletesting.blogspot.com/2007/03/javascript-simulating-time-in-jsunit.html">using the jsUnit Clock object to deal with timeouts and&nbsp;intervals.</a></p>
<p>QUnit <code>DOM</code> support is not included. Consider avoiding interacting directly with the browser within your unit tests. But if you do need to, you’ll need to create and remove the <span class="caps">DOM</span> objects yourself with each test, or the <code>setup</code> and <code>teardown</code> methods.</p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/">« Full blog</a></div>
        <section class="about"><p>Personal homepage of Karl O’Keeffe.</p>

        </section>
        <section class="copy">
          <p>© 2015 Karl O'Keeffe</p>
        </section>
      </div>
    </footer>
  </body>
</html>