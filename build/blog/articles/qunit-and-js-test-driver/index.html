<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>QUnit and JS Test Driver - Karl O'Keeffe
    </title>
    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <style>body {
  box-sizing: border-box;
  color: #333;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 16px;
  letter-spacing: 0.2px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  word-wrap: break-word;
}

a {
  color: #2469C8;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

h1, h2, h3, h4, h5, h6, p, body, a, img, ul, ol, blockquote, pre {
  margin: 0; padding: 0; border: 0;
}

body {
  background-color: #ffffff;
  /*text-rendering: optimizeLegibility;*/
}

.content-wrap {
  width: 34em;
  margin: 0 auto;
}

p {
  margin-top: 0;
  margin-bottom: 16px;
}

h1 {
  font-size: 2em;
  margin-bottom: 1em;
}

h2 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  padding-bottom: .3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

h3 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  font-size: 1.5em;
  line-height: 1.43;
}

ol, ul {
  padding: 0;
  padding-left: 2em;
  margin-top: 0;
  margin-bottom: 16px;
}

blockquote {
  margin: 1.2em 3em;
  padding-left: 1em;
  font-style: italic;
}

hr {
  border: 0;
  border-top: 1px dashed #d2d2d2;
  height: 0;
  margin: 1.6em 0;
}

/* page header */

.header {
  padding: 2em;
  background: #FFA91A;
}

.header h1 {
  font-size: 2.6em;
  text-align: center;
  font-weight: 700;
  margin: 0;
}

.header a, .header a:hover {
  text-decoration: none;
  color: #ffffff;
}

/* page footer */

footer {
  margin: 3em 0;
}

footer .nav {
  text-align: center;
  margin-top: 5em;
  margin-bottom: 3.5em;
}

footer .nav a {
  padding: 0 0.5em;
  font-size: 1.2em;
  text-decoration: none;
}

footer .about {
  padding: 2.2em 3em;
  text-align: center;
  color: #888;
}

/* article */

.article {
  margin: 3em 0 4em;
}

.article header .date {
  text-align: center;
  margin-top: -0.7em;
}

.article .content img {
  display: block;
  width: 100%;
}

/* code styling */

p code,
h2 code {
  font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
  padding: 0;
  padding-top: .2em;
  padding-bottom: .2em;
  margin: 0;
  font-size: 85%;
  background-color: #f7f7f7;
  border-radius: 3px;
}

h2 code:before,
h2 code:after,
p code:before,
p code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

pre {
  font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
  word-wrap: normal;
  padding: 16px;
  overflow: auto;
  /*font-size: 100%;*/
  font-size: 13.6px;
  line-height: 1.45;
  background-color: #f7f7f7;
  border: 0;
  border-radius: 3px;
  margin-top: 0;
  margin-bottom: 16px;
}

pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
  /*font-size: 100%;*/
  white-space: pre;
  background: transparent;
  border-radius: 3px;
}

/* syntax hl stuff */

code.lang-markdown {
  color: #424242;
}

code.lang-markdown .header,
code.lang-markdown .strong {
  font-weight: bold;
}

code.lang-markdown .emphasis {
  font-style: italic;
}

code.lang-markdown .horizontal_rule,
code.lang-markdown .link_label,
code.lang-markdown .code,
code.lang-markdown .header,
code.lang-markdown .link_url {
  color: #555;
}

code.lang-markdown .blockquote,
code.lang-markdown .bullet {
  color: #bbb;
}

/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
.tomorrow-comment, pre .comment, pre .title {
  color: #8e908c;
}

.tomorrow-red, pre .variable, pre .attribute, pre .tag, pre .regexp, pre .ruby .constant, pre .xml .tag .title, pre .xml .pi, pre .xml .doctype, pre .html .doctype, pre .css .id, pre .css .class, pre .css .pseudo {
  color: #c82829;
}

.tomorrow-orange, pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
  color: #f5871f;
}

.tomorrow-yellow, pre .class, pre .ruby .class .title, pre .css .rules .attribute {
  color: #eab700;
}

.tomorrow-green, pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
  color: #718c00;
}

.tomorrow-aqua, pre .css .hexcolor {
  color: #3e999f;
}

.tomorrow-blue, pre .function, pre .python .decorator, pre .python .title, pre .ruby .function .title, pre .ruby .title .keyword, pre .perl .sub, pre .javascript .title, pre .coffeescript .title {
  color: #4271ae;
}

.tomorrow-purple, pre .keyword, pre .javascript .function {
  color: #8959a8;
}

/* media queries */

@media (max-width: 690px) {
  .content-wrap {
    width: auto;
    padding: 0 1em;
  }
  .header {
    padding: 1em;
  }
  .header h1 {
    font-size: 1.4em;
  }
  .article {
    margin: 1em 0 2.5em;
  }
  .archive {
    width: 80%;
    margin: 0 auto;
  }
  .archive * {
    float: none !important;
    line-height: 1.6 !important;
    width: auto !important;
    height: auto !important;
    text-align: left !important;
    border: 0 !important;
    margin: 0 !important;
  }
  footer .nav {
    margin: 1em 0;
  }
  footer .about {
    padding: 0;
    padding-top: 1.6em;
  }
  footer .about p {
    margin-bottom: 1em;
  }
}

    </style>
  </head>
  <body>
    <header class="header">
      <div class="content-wrap">
        <div class="logo">
          <h1><a href="/">Karl O'Keeffe</a></h1>
        </div>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <header>
            <h2><a href="/blog/articles/qunit-and-js-test-driver/">QUnit and JS Test Driver</a></h2>
            <p class="date"><span>21. June 2009</span></p>
          </header>
          <section class="content"><div class="info">This post has obsoleted been the <a href="http://code.google.com/p/js-test-driver/wiki/QUnitAdapter">new QUnit Adapter</a> I created, check it out!</div>

<p>I was very impressed by the new Google <a href="http://code.google.com/p/js-test-driver/"><span class="caps">JS</span> Test Driver</a> project, which provides a blisteringly fast, and easily automated way of running your Javascript unit tests. See this <a href="http://misko.hevery.com/2009/05/22/yet-another-javascript-testing-framework/">introduction to <span class="caps">JS</span> Test Driver by Miško Hevery</a> for a great&nbsp;overview.</p>
<p>I previously described how to <a href="/articles/autotest-and-js-test-driver/">run <span class="caps">JS</span> Test Driver automatically with Autotest</a>.</p>
<p>But I have an existing project that uses the jQuery testing framework <a href="http://docs.jquery.com/QUnit">qunit</a> for testing. I didn’t really fancy rewriting 300+ tests just so I could use the <span class="caps">JS</span> Test Driver&nbsp;framework.</p>
<p>So I wrote a converter that automatically converts qunit modules and tests into <span class="caps">JS</span> Test Driver TestCases and test&nbsp;methods.</p>
<h2 id="download-converter-and-patched-testrunner">Download Converter and Patched&nbsp;Testrunner</h2>
<p>In order to convert from qunit tests I’ve had to add a few extra hooks into the qunit <code>testrunner.js</code> file.</p>
<p>Either <a href="/blog/articles/qunit-and-js-test-driver/testrunner.js">download the patched testrunner.js</a> file, or just add the 3 lines&nbsp;below:</p>
<pre><code class="lang-javascript">    QUnit: {
        <span class="comment">// Add the following 3 lines</span>
        runTest: runTest,
        <span class="attr">config</span>: config,
        <span class="attr">validTest</span>: validTest,

        <span class="comment">// This is existing code</span>
        equiv: equiv,
        <span class="attr">ok</span>: ok,
        <span class="attr">done</span>: <span class="function"><span class="keyword">function</span>(<span class="params">failures, total</span>)</span>{},
        <span class="attr">log</span>: <span class="function"><span class="keyword">function</span>(<span class="params">result, message</span>)</span>{}
    },
</code></pre>
<p>Next <a href="/blog/articles/qunit-and-js-test-driver/QUnitToTestCases.js">download QUnitToTestCases.js</a> and save it to the same folder as <code>testrunner.js</code>. This is the file which converts the qunit tests into TestCases that <span class="caps">JS</span> Test Driver&nbsp;understands.</p>
<p>It works by overriding the qunit <code>test()</code> function, and rather than adding the test to qunit, it creates a test method on a TestCase object which, when called by <span class="caps">JS</span> Test Driver adds the test to qunit and runs&nbsp;it.</p>
<h2 id="configuring-js-test-driver">Configuring <span class="caps">JS</span> Test&nbsp;Driver</h2>
<p>Once you have the patched <code>testrunner.js</code> and <code>QUnitToTestCases.js</code>, you just need to let <span class="caps">JS</span> Test Driver know to load them before your qunit tests. They need to be loaded in order, with  <code>testrunner.js</code> first, followed by <code>QUnitTiTestCases.js</code>, as the converter modifies some of the testrunner&nbsp;methods.</p>
<p>Update your <code>jsTestDriver.conf</code> to load the&nbsp;files:</p>
<pre><code class="lang-yaml"><span class="attr">server:</span> http://localhost:<span class="number">9876</span>

<span class="attr">load:</span>
  <span class="comment"># Add these lines to load the testrunner and converter in order, before the tests</span>
  <span class="comment"># (assuming the files are saved to tests/qunit/)</span>
<span class="bullet">  -</span> tests/qunit/testrunner.js
<span class="bullet">  -</span> tests/qunit/QUnitToTestCases.js

  <span class="comment"># This is where we load the qunit tests</span>
<span class="bullet">  -</span> tests/js/*.js

  <span class="comment"># And this loads the source files we are testing</span>
<span class="bullet">  -</span> src/js/*.js
</code></pre>
<h2 id="running-js-test-driver-with-qunit-tests">Running <span class="caps">JS</span> Test Driver with qunit&nbsp;tests</h2>
<p>Now we can run <span class="caps">JS</span> Test Driver and watch as it runs all our qunit&nbsp;tests!</p>
<p>The tests will run as individual <span class="caps">JS</span> Test Driver tests, with the format <code>_Module Name_._Test Name_</code>.</p>
<p>Example&nbsp;output:</p>
<pre><code class="lang-plain">[PASSED] Module 1.test Test 1
[PASSED] Module 1.test Test 2
[PASSED] Module 2.test Test 1
Total 3 tests (Passed: 3; Fails: 0; Errors: 0) (1.00 ms)
  Safari 530.18: Run 3 tests (Passed: 3; Fails: 0; Errors 0) (1.00 ms)
</code></pre>
<h2 id="limitations">Limitations</h2>
<p>There are a few limitations on which qunit tests will successfully be&nbsp;converted.</p>
<p>The tests must run synchronously (which means no use of the qunit <code>stop</code> and <code>start</code> methods).</p>
<p>Module lifecycles are ignored at the moment, which means <code>setup</code> and <code>teardown</code> functions are not&nbsp;called.</p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/blog/">Full blog</a></div>
        <section class="about"><p>Personal homepage of <a href="/">Karl O’Keeffe</a>.</p>

        </section>
      </div>
    </footer>
  </body>
</html>