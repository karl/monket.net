<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Javascript Lint with Autotest - Karl O'Keeffe
    </title>
    <link rel="alternate" href="//feed.xml" type="application/rss+xml" title="">
    <style>body {
  box-sizing: border-box;
  color: #333;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 16px;
  letter-spacing: 0.2px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  word-wrap: break-word;
}

a {
  color: #2469C8;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

h1, h2, h3, h4, h5, h6, p, body, a, img, ul, ol, blockquote, pre {
  margin: 0; padding: 0; border: 0;
}

body {
  background-color: #ffffff;
  /*text-rendering: optimizeLegibility;*/
}

.content-wrap {
  width: 34em;
  margin: 0 auto;
}

p {
  margin-top: 0;
  margin-bottom: 16px;
}

h1 {
  font-size: 2em;
  margin-bottom: 1em;
}

h2 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  padding-bottom: .3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

h3 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  font-size: 1.5em;
  line-height: 1.43;
}

ol, ul {
  padding: 0;
  padding-left: 2em;
  margin-top: 0;
  margin-bottom: 16px;
}

blockquote {
  margin: 1.2em 3em;
  padding-left: 1em;
  font-style: italic;
}

hr {
  border: 0;
  border-top: 1px dashed #d2d2d2;
  height: 0;
  margin: 1.6em 0;
}

/* page header */

.header {
  padding: 2em;
  background: #FFA91A;
}

.header h1 {
  font-size: 2.6em;
  text-align: center;
  font-weight: 700;
  margin: 0;
}

.header a, .header a:hover {
  text-decoration: none;
  color: #ffffff;
}

/* page footer */

footer {
  margin: 3em 0;
}

footer .nav {
  text-align: center;
  margin-top: 5em;
  margin-bottom: 3.5em;
}

footer .nav a {
  padding: 0 0.5em;
  font-size: 1.2em;
  text-decoration: none;
}

footer .about {
  padding: 2.2em 3em;
  text-align: center;
  color: #888;
}

/* article */

.article {
  margin: 3em 0 4em;
}

.article header .date {
  text-align: center;
  margin-top: -0.7em;
}

.article .content img {
  display: block;
  width: 100%;
}

/* code styling */

p code,
h2 code {
  font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
  padding: 0;
  padding-top: .2em;
  padding-bottom: .2em;
  margin: 0;
  font-size: 85%;
  background-color: #f7f7f7;
  border-radius: 3px;
}

h2 code:before,
h2 code:after,
p code:before,
p code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

pre {
  font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
  word-wrap: normal;
  padding: 16px;
  overflow: auto;
  /*font-size: 100%;*/
  font-size: 13.6px;
  line-height: 1.45;
  background-color: #f7f7f7;
  border: 0;
  border-radius: 3px;
  margin-top: 0;
  margin-bottom: 16px;
}

pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
  /*font-size: 100%;*/
  white-space: pre;
  background: transparent;
  border-radius: 3px;
}

/* syntax hl stuff */

code.lang-markdown {
  color: #424242;
}

code.lang-markdown .header,
code.lang-markdown .strong {
  font-weight: bold;
}

code.lang-markdown .emphasis {
  font-style: italic;
}

code.lang-markdown .horizontal_rule,
code.lang-markdown .link_label,
code.lang-markdown .code,
code.lang-markdown .header,
code.lang-markdown .link_url {
  color: #555;
}

code.lang-markdown .blockquote,
code.lang-markdown .bullet {
  color: #bbb;
}

/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
.tomorrow-comment, pre .comment, pre .title {
  color: #8e908c;
}

.tomorrow-red, pre .variable, pre .attribute, pre .tag, pre .regexp, pre .ruby .constant, pre .xml .tag .title, pre .xml .pi, pre .xml .doctype, pre .html .doctype, pre .css .id, pre .css .class, pre .css .pseudo {
  color: #c82829;
}

.tomorrow-orange, pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
  color: #f5871f;
}

.tomorrow-yellow, pre .class, pre .ruby .class .title, pre .css .rules .attribute {
  color: #eab700;
}

.tomorrow-green, pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
  color: #718c00;
}

.tomorrow-aqua, pre .css .hexcolor {
  color: #3e999f;
}

.tomorrow-blue, pre .function, pre .python .decorator, pre .python .title, pre .ruby .function .title, pre .ruby .title .keyword, pre .perl .sub, pre .javascript .title, pre .coffeescript .title {
  color: #4271ae;
}

.tomorrow-purple, pre .keyword, pre .javascript .function {
  color: #8959a8;
}

/* media queries */

@media (max-width: 690px) {
  .content-wrap {
    width: auto;
    padding: 0 1em;
  }
  .header {
    padding: 1em;
  }
  .header h1 {
    font-size: 1.4em;
  }
  .article {
    margin: 1em 0 2.5em;
  }
  .archive {
    width: 80%;
    margin: 0 auto;
  }
  .archive * {
    float: none !important;
    line-height: 1.6 !important;
    width: auto !important;
    height: auto !important;
    text-align: left !important;
    border: 0 !important;
    margin: 0 !important;
  }
  footer .nav {
    margin: 1em 0;
  }
  footer .about {
    padding: 0;
    padding-top: 1.6em;
  }
  footer .about p {
    margin-bottom: 1em;
  }
}

    </style>
  </head>
  <body>
    <header class="header">
      <div class="content-wrap">
        <div class="logo">
          <h1><a href="/">Karl O'Keeffe</a></h1>
        </div>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <header>
            <h2><a href="/blog/articles/javascript-lint-with-autotest/">Javascript Lint with Autotest</a></h2>
            <p class="date"><span>15. June 2009</span></p>
          </header>
          <section class="content"><p>As well as using <a href="/articles/autotest-cucumber-and-growl/">Autotest to run Cucumber scenarios</a> I have also been looking into integrating lower level test into the Autotest&nbsp;cycle.</p>
<p>My first attempt at this is a small module to run <a href="http://javascriptlint.com/">Javascript Lint</a> on all the javascript files within a project any time any file&nbsp;changes.</p>
<p>The module below hooks in to Autotest just before the tests are normally run. It runs javascript lint over all the <code>*.js</code> files in the project, outputs the results to the autotest results object and the standard output, and finally fires a new <code>ran_javascript_lint</code> hook</p>
<p>Errors and warnings found by Javascript Lint will also be notified through <a href="http://growl.info/">Growl</a> (if Growl and <a href="http://github.com/svoop/autotest-growl/tree/master">autotest-growl</a> are installed). If there are no errors or warnings than no Growl notification is shown. This keeps distracting popups to a&nbsp;minimum.</p>
<h2 id="installing-autotest-javascript-lint">Installing Autotest Javascript&nbsp;Lint</h2>
<p>First up, <a href="http://javascriptlint.com/download.htm">download Javascript Lint</a>. Extract the <code>jsl</code> executable to <code>lib/autotest/</code> within your&nbsp;project.</p>
<p>Copy the code below to <code>lib/autotest/javascript-lint.rb</code> within your project (the same directory where you have the <code>jsl</code> execuatable).</p>
<h4 id="javascript-lint-rb">javascript-lint.rb</h4>
<pre><code class="lang-ruby"><span class="comment"># Run Javascript Lint as part of autotest</span>
<span class="comment"># Supports Growl notifications if using autotest-growl</span>
<span class="comment">#</span>
<span class="comment"># Version 1.0</span>

<span class="keyword">require</span> <span class="string">'autotest'</span>

<span class="class"><span class="keyword">module</span> <span class="title">Autotest::JavascriptLint</span></span>
    <span class="variable">@@js_dir</span> = <span class="string">''</span>
    <span class="variable">@@jsl_dir</span> = <span class="constant">File</span>.dirname(__FILE_<span class="number">_</span>) + <span class="string">'/'</span>
    <span class="variable">@@config_file</span> = <span class="string">''</span>

    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">js_dir=</span><span class="params">(string)</span></span>
        <span class="variable">@@js_dir</span> = string
    <span class="keyword">end</span>

    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">jsl_dir=</span><span class="params">(string)</span></span>
        <span class="variable">@@jsl_dir</span> = string
    <span class="keyword">end</span>

    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">config_file=</span><span class="params">(string)</span></span>
        <span class="variable">@@config_file</span> = string
    <span class="keyword">end</span>

    <span class="constant">Autotest</span>.add_hook <span class="symbol">:run_command</span> <span class="keyword">do</span> |at|

        <span class="comment"># run javascript lint</span>
        results = <span class="string">`<span class="subst">#{<span class="variable">@@jsl_dir</span>}</span>jsl -conf "<span class="subst">#{<span class="variable">@@config_file</span>}</span>"  -process "<span class="subst">#{<span class="variable">@@js_dir</span>}</span>*.js" +recurse`</span>
        puts results

        at.results = [] <span class="keyword">if</span> at.results.<span class="keyword">nil</span>?
        at.results.concat(results.split(<span class="string">"\n"</span>))

        at.hook <span class="symbol">:ran_javascript_lint</span>
    <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="class"><span class="keyword">module</span> <span class="title">Autotest::Growl</span></span>

    <span class="variable">@@show_js_lint_success</span> = <span class="keyword">false</span>

    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">show_js_lint_success=</span><span class="params">(bool)</span></span>
        <span class="variable">@@show_js_lint_success</span>=bool
    <span class="keyword">end</span>

    <span class="comment"># Growl results of Javscript Lint</span>
    <span class="constant">Autotest</span>.add_hook <span class="symbol">:ran_javascript_lint</span> <span class="keyword">do</span> |autotest|
        gist = autotest.results.grep(<span class="regexp">/\d+\s+error.*,\s+\d+\s+warning.*/</span>).join(<span class="string">" / "</span>).strip()

        <span class="keyword">if</span> gist == <span class="string">''</span>
            growl <span class="variable">@label</span> + <span class="string">'Cannot run javascript lint.'</span>, <span class="string">''</span>, <span class="string">'error'</span>
        <span class="keyword">else</span>
            <span class="keyword">if</span> gist =~ <span class="regexp">/[1-9]\d*\s+(error)/</span>
                growl <span class="variable">@label</span> + <span class="string">'Lint: Some files have errors.'</span>, gist, <span class="string">'failed'</span>
            <span class="keyword">elsif</span> gist =~ <span class="regexp">/[1-9]\d*\s+(warning)/</span>
                growl <span class="variable">@label</span> + <span class="string">'Lint: Some files have warnings.'</span>, gist, <span class="string">'pending'</span>
            <span class="keyword">elsif</span> <span class="variable">@@show_js_lint_success</span>
                growl <span class="variable">@label</span> + <span class="string">'Lint: All files are clean.'</span>, gist, <span class="string">'passed'</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">false</span>
    <span class="keyword">end</span>

<span class="keyword">end</span>
</code></pre>
<p>Then add Autotest Javascript Lint to your <code>.autotest</code> configuration file within the base of your&nbsp;project.</p>
<pre><code class="lang-ruby"><span class="keyword">require</span> <span class="string">'lib/autotest/javascript-lint'</span>
</code></pre>
<h2 id="to-do">To&nbsp;Do</h2>
<p>This could be packaged as a gem for easy installation, and it could possibly be modified to only run over changed&nbsp;files.</p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/blog/">Full blog</a></div>
        <section class="about"><p>Personal homepage of <a href="/">Karl O’Keeffe</a>.</p>

        </section>
      </div>
    </footer>
  </body>
</html>