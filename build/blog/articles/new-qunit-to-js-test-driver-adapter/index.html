<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>New QUnit to JS Test Driver adapter - Karl O'Keeffe
    </title>
    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <style>body {
  box-sizing: border-box;
  color: #333;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 16px;
  letter-spacing: 0.2px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  word-wrap: break-word;
}

a {
  color: #2469C8;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

h1, h2, h3, h4, h5, h6, p, body, a, img, ul, ol, blockquote, pre {
  margin: 0; padding: 0; border: 0;
}

body {
  background-color: #ffffff;
  /*text-rendering: optimizeLegibility;*/
}

.content-wrap {
  width: 34em;
  margin: 0 auto;
}

p {
  margin-top: 0;
  margin-bottom: 16px;
}

h1 {
  font-size: 2em;
  margin-bottom: 1em;
}

h2 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  padding-bottom: .3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

h3 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  font-size: 1.5em;
  line-height: 1.43;
}

ol, ul {
  padding: 0;
  padding-left: 2em;
  margin-top: 0;
  margin-bottom: 16px;
}

blockquote {
  margin: 1.2em 3em;
  padding-left: 1em;
  font-style: italic;
}

hr {
  border: 0;
  border-top: 1px dashed #d2d2d2;
  height: 0;
  margin: 1.6em 0;
}

/* page header */

.header {
  padding: 2em;
  background: #FFA91A;
}

.header h1 {
  font-size: 2.6em;
  text-align: center;
  font-weight: 700;
  margin: 0;
}

.header a, .header a:hover {
  text-decoration: none;
  color: #ffffff;
}

/* page footer */

footer {
  margin: 3em 0;
}

footer .nav {
  text-align: center;
  margin-top: 5em;
  margin-bottom: 3.5em;
}

footer .nav a {
  padding: 0 0.5em;
  font-size: 1.2em;
  text-decoration: none;
}

footer .about {
  padding: 2.2em 3em;
  text-align: center;
  color: #888;
}

/* article */

.article {
  margin: 3em 0 4em;
}

.article header .date {
  text-align: center;
  margin-top: -0.7em;
}

.article .content img {
  display: block;
  width: 100%;
}

/* code styling */

p code,
h2 code {
  font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
  padding: 0;
  padding-top: .2em;
  padding-bottom: .2em;
  margin: 0;
  font-size: 85%;
  background-color: #f7f7f7;
  border-radius: 3px;
}

h2 code:before,
h2 code:after,
p code:before,
p code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

pre {
  font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
  word-wrap: normal;
  padding: 16px;
  overflow: auto;
  /*font-size: 100%;*/
  font-size: 13.6px;
  line-height: 1.45;
  background-color: #f7f7f7;
  border: 0;
  border-radius: 3px;
  margin-top: 0;
  margin-bottom: 16px;
}

pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
  /*font-size: 100%;*/
  white-space: pre;
  background: transparent;
  border-radius: 3px;
}

/* syntax hl stuff */

code.lang-markdown {
  color: #424242;
}

code.lang-markdown .header,
code.lang-markdown .strong {
  font-weight: bold;
}

code.lang-markdown .emphasis {
  font-style: italic;
}

code.lang-markdown .horizontal_rule,
code.lang-markdown .link_label,
code.lang-markdown .code,
code.lang-markdown .header,
code.lang-markdown .link_url {
  color: #555;
}

code.lang-markdown .blockquote,
code.lang-markdown .bullet {
  color: #bbb;
}

/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
.tomorrow-comment, pre .comment, pre .title {
  color: #8e908c;
}

.tomorrow-red, pre .variable, pre .attribute, pre .tag, pre .regexp, pre .ruby .constant, pre .xml .tag .title, pre .xml .pi, pre .xml .doctype, pre .html .doctype, pre .css .id, pre .css .class, pre .css .pseudo {
  color: #c82829;
}

.tomorrow-orange, pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
  color: #f5871f;
}

.tomorrow-yellow, pre .class, pre .ruby .class .title, pre .css .rules .attribute {
  color: #eab700;
}

.tomorrow-green, pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
  color: #718c00;
}

.tomorrow-aqua, pre .css .hexcolor {
  color: #3e999f;
}

.tomorrow-blue, pre .function, pre .python .decorator, pre .python .title, pre .ruby .function .title, pre .ruby .title .keyword, pre .perl .sub, pre .javascript .title, pre .coffeescript .title {
  color: #4271ae;
}

.tomorrow-purple, pre .keyword, pre .javascript .function {
  color: #8959a8;
}

/* media queries */

@media (max-width: 690px) {
  .content-wrap {
    width: auto;
    padding: 0 1em;
  }
  .header {
    padding: 1em;
  }
  .header h1 {
    font-size: 1.4em;
  }
  .article {
    margin: 1em 0 2.5em;
  }
  .archive {
    width: 80%;
    margin: 0 auto;
  }
  .archive * {
    float: none !important;
    line-height: 1.6 !important;
    width: auto !important;
    height: auto !important;
    text-align: left !important;
    border: 0 !important;
    margin: 0 !important;
  }
  footer .nav {
    margin: 1em 0;
  }
  footer .about {
    padding: 0;
    padding-top: 1.6em;
  }
  footer .about p {
    margin-bottom: 1em;
  }
}

    </style>
  </head>
  <body>
    <header class="header">
      <div class="content-wrap">
        <div class="logo">
          <h1><a href="/">Karl O'Keeffe</a></h1>
        </div>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <header>
            <h2><a href="/blog/articles/new-qunit-to-js-test-driver-adapter/">New QUnit to JS Test Driver adapter</a></h2>
            <p class="date"><span>23. June 2009</span></p>
          </header>
          <section class="content"><div class="info">The code in this post is out of date. The latest code can always be found in the <a href="http://code.google.com/p/js-test-driver/wiki/QUnitAdapter"><span class="caps">JS</span> Test Driver google code site</a></div>

<p>In my <a href="/articles/qunit-and-js-test-driver/">previous post on QUnit and <span class="caps">JS</span> Test Driver</a> I showed how to run your <a href="http://docs.jquery.com/QUnit">qunit</a> tests with <a href="http://code.google.com/p/js-test-driver/"><span class="caps">JS</span> Test Driver</a>.</p>
<p>The technique used was to run the tests with qunit, and report either their success or failure to <span class="caps">JS</span> Test Driver. This works, but you miss out on the important feedback of exactly which assertions have failed, and&nbsp;why.</p>
<p>This problem has led me to taking a new approach to running qunit tests with <span class="caps">JS</span> Test Driver, where I don’t use any of the existing qunit code, and instead just create an interface wrapper that converts qunit style tests and assertions directly into JS Test Driver tests and&nbsp;assertions.</p>
<p>This gives assertion level error reporting, making it much easier to write and debug tests. Essentially this adapter allows you to write native <span class="caps">JS</span> Test Driver tests, but using the less verbose qunit&nbsp;syntax.</p>
<p>The new approach also means that qunit lifecycles (setup and teardown)&nbsp;work.</p>
<h2 id="installing-the-qunit-adapter">Installing the QUnit&nbsp;Adapter</h2>
<p>First up download the <a href="/blog/articles/new-qunit-to-js-test-driver-adapter/equiv.js">equiv.js</a> file, which is required for the qunit <code>same</code> assertion.</p>
<p>Then download the <a href="/blog/articles/new-qunit-to-js-test-driver-adapter/QUnitAdapter.js">QUnitAdapter.js</a> file (or copy the code&nbsp;below).</p>
<h4 id="-qunitadapter-js-qunitadapter-js-"><a href="/blog/articles/new-qunit-to-js-test-driver-adapter/QUnitAdapter.js">QUnitAdapter.js</a></h4>
<pre><code class="lang-javascript">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{

    <span class="built_in">window</span>.module = <span class="function"><span class="keyword">function</span>(<span class="params">name, lifecycle</span>) </span>{
        QUnitTestCase = TestCase(name);

        <span class="keyword">if</span> (lifecycle) {
            QUnitTestCase.prototype.setUp = lifecycle.setup;
            QUnitTestCase.prototype.tearDown = lifecycle.teardown;
        }
    };

    <span class="built_in">window</span>.test = <span class="function"><span class="keyword">function</span>(<span class="params">name, test</span>) </span>{
        QUnitTestCase.prototype[<span class="string">'test '</span> + name] = test;
    };

    <span class="built_in">window</span>.expect = <span class="function"><span class="keyword">function</span>(<span class="params">count</span>) </span>{
        expectAsserts(count);
    };

    <span class="built_in">window</span>.ok = <span class="function"><span class="keyword">function</span>(<span class="params">actual, msg</span>) </span>{
        assertTrue(msg ? msg : <span class="string">''</span>, actual);
    };

    <span class="built_in">window</span>.equals = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, msg</span>) </span>{
        assertEquals(msg ? msg : <span class="string">''</span>, b, a);
    };

    <span class="built_in">window</span>.start = <span class="built_in">window</span>.stop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
        fail(<span class="string">'start and stop methods are not available when using <span class="caps">JS</span> Test Driver.\n'</span> +
            <span class="string">'Use jsUnit Clock object to deal with timeouts and intervals:\n'</span> +
            <span class="string">'http://googletesting.blogspot.com/2007/03/javascript-simulating-time-in-jsunit.html.'</span>);
    };

    <span class="built_in">window</span>.same = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, msg</span>) </span>{
        assertTrue(msg ? msg : <span class="string">''</span>, <span class="built_in">window</span>.equiv(b, a));
    };

    <span class="built_in">window</span>.reset = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
        fail(<span class="string">'reset method is not available when using <span class="caps">JS</span> Test Driver'</span>);
    };

    <span class="built_in">window</span>.isLocal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
        <span class="keyword">return</span> <span class="literal">false</span>;
    };

    <span class="built_in">window</span>.QUnit = {
        equiv: <span class="built_in">window</span>.equiv,
        ok: <span class="built_in">window</span>.ok
    };

})();
</code></pre>
<p>Save both these files to your project (for example <code>tests/qunit/</code>).</p>
<h2 id="configuring-js-test-driver">Configuring <span class="caps">JS</span> Test&nbsp;Driver</h2>
<p>To run your qunit tests in <span class="caps">JS</span> Test Driver you need to configure it to load the adapter before your qunit&nbsp;tests.</p>
<p>Update your <code>jsTestDriver.conf</code> to load the&nbsp;files:</p>
<pre><code class="lang-yaml">server: http://localhost:9876

load:
  # Add these lines to load the equiv function and adapter in order, before the tests
  # (assuming they are saved to tests/qunit/)
  - tests/qunit/equiv.js
  - tests/qunit/QUnitAdapter.js

  # This is where we load the qunit tests
  - tests/js/*.js

  # And this loads the source files we are testing
  - src/js/*.js
</code></pre>
<h2 id="running-js-test-driver-with-qunit-tests">Running <span class="caps">JS</span> Test Driver with qunit&nbsp;tests</h2>
<p>Now we can run <span class="caps">JS</span> Test Driver and watch as it runs all our qunit&nbsp;tests!</p>
<p>The tests will run as individual <span class="caps">JS</span> Test Driver tests, with the format <code>_Module Name_._Test Name_</code>.</p>
<p>Example&nbsp;output:</p>
<pre><code class="lang-plain">[PASSED] Module 1.test Test 1
[PASSED] Module 1.test Test 2
[PASSED] Module 2.test Test 1
Total 3 tests (Passed: 3; Fails: 0; Errors: 0) (1.00 ms)
  Safari 530.18: Run 3 tests (Passed: 3; Fails: 0; Errors 0) (1.00 ms)
</code></pre>
<h2 id="limitations">Limitations</h2>
<p>There are a few limitations on which qunit tests will successfully be&nbsp;converted.</p>
<p>The tests must run synchronously (which means no use of the qunit <code>stop</code> and <code>start</code> methods).</p>
<p>If you need to test timeouts, intervals, or other asynchronous sections of  code, consider <a href="http://googletesting.blogspot.com/2007/03/javascript-simulating-time-in-jsunit.html">using the jsUnit Clock object to deal with timeouts and&nbsp;intervals.</a></p>
<p>QUnit <code>DOM</code> support is not included. Consider avoiding interacting directly with the browser within your unit tests. But if you do need to, you’ll need to create and remove the <span class="caps">DOM</span> objects yourself with each test, or the <code>setup</code> and <code>teardown</code> methods.</p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/blog/">Full blog</a></div>
        <section class="about"><p>Personal homepage of <a href="/">Karl O’Keeffe</a>.</p>

        </section>
      </div>
    </footer>
  </body>
</html>